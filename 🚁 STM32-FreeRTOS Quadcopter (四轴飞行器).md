# 🚁 STM32-FreeRTOS Quadcopter (四轴飞行器)

## 📖 项目简介 (Introduction)

本项目设计并实现了一款基于 **STM32F103C8T6** 主控芯片和 **FreeRTOS** 实时操作系统的微型四轴飞行器。项目涵盖了从底层驱动开发、姿态解算算法（卡尔曼滤波/四元数）到上层飞行控制策略（串级PID）的全栈开发。

飞行器通过 2.4G 无线模块接收遥控器的摇杆与按键指令，能够实现自主姿态平衡和基于激光测距的定高悬停。

📺 **[点击观看功能演示视频 (Bilibili)](https://www.bilibili.com/video/BV1hJb1zME6Q?vd_source=1d6eb56c93cf780491517dccbef2468a)**

## 🛠️ 技术栈 (Tech Stack)

### 硬件平台 (Hardware)

* **主控芯片**: STM32F103C8T6 (ARM Cortex-M3)
* **动力系统**: 8520 空心杯电机 + PWM 调速
* **姿态传感器**: MPU6050 (6轴加速度计/陀螺仪)
* **测距传感器**: VL53L1X (激光 ToF，用于定高)
* **无线通信**: SI24R1 (2.4G 射频模块，兼容 NRF24L01)
* **人机交互**: 0.96寸 OLED 显示屏，四个led灯控
* **电源管理**: ADC + DMA 采集电池电压

### 软件架构 (Software)

* **开发环境**: Keil MDK / STM32CubeMX

* **操作系统**: FreeRTOS

* **通信协议**: USART, I2C, SPI

* **核心算法**:
    
    * **姿态解算**: 互补滤波 / 卡尔曼滤波 (加速度计) + 低通滤波 (角速度) + 四元数解算
    
    * **控制算法**: 串级 PID 控制 (内环：角速度/Z轴速度，外环：角度/高度)
    
      

## ✨ 核心功能 (Key Features)

* **多任务实时调度**: 基于 FreeRTOS 将系统划分为飞行控制、姿态解算、通信、UI显示等多个任务，利用优先级抢占调度保证控制回路的实时性。
* **高精度姿态解算**: 对传感器原始数据进行滤波处理，通过四元数算法实时输出欧拉角。
* **串级 PID 控制**:
    * **姿态环**: 角度环（外环）+ 角速度环（内环），实现快速且无超调的姿态响应。
    * **高度环**: 高度环（外环）+ Z轴速度环（内环），结合 VL53L1X 实现定高悬停。
* **无线遥控**: 自定义 2.4G 数据帧协议，实现低延迟的控制指令下发及数据回传。
* **安全机制**: 具备电池电压监测、通信丢包保护、电机异常处理等功能。

## 📊 性能指标 (Achievements)

经过参数整定与调试，本项目达到了以下性能指标：

|       指标       |       表现       |                备注                |
| :--------------: | :--------------: | :--------------------------------: |
| **姿态平衡精度** |       ±1度       |        响应迅速，无明显震荡        |
| **定高悬停精度** |      ±3厘米      |            室内无风环境            |
| **控制响应优化** | 响应时间缩短 50% |            相比单环 PID            |
|  **抗干扰能力**  |       良好       | 解决了电机噪声干扰与突发障碍物干扰 |

## 🧩 系统架构与任务分配 (System Architecture)

FreeRTOS 任务优先级与功能分配如下：

1.  **TASK_Flight_Ctrl (High Priority)**: 负责 PID 运算与电机 PWM 输出，保证控制周期严格稳定。
2.  **TASK_Attitude (High Priority)**: 读取 MPU6050 数据并进行卡尔曼滤波与姿态解算。
3.  **TASK_Comms**: 处理 SI24R1 的数据收发，解析遥控器指令。
4.  **TASK_Display**: 刷新 OLED 屏幕，显示电压、模式与姿态角。
5.  **TASK_Sensors**: 读取 VL53L1X 高度数据及 ADC 电池电压。

## 🚀 快速开始 (Getting Started)

1.  **克隆仓库**:
    ```bash
    git clone [https://github.com/langhz666/stm32-sizhoufeixingqi.git](https://github.com/langhz666/stm32-sizhoufeixingqi.git)
    ```
2.  **硬件连接**: 按照引脚定义图连接电机、传感器与主控板。
3.  **编译烧录**: 使用 Keil MDK 打开工程文件，编译并下载至 STM32F103。
4.  **传感器校准**: 上电后保持静止 3 秒，等待陀螺仪零偏校准完成。
5.  **解锁起飞**: 打开遥控器，连接成功后（LED 常亮），进行解锁操作即可飞行。

## 🤝 贡献与反馈 (Contribution)

欢迎提交 Issue 或 Pull Request 来改进本项目！
如果你觉得这个项目对你有帮助，请给一个 ⭐️ **Star**！

---
**Author**: [langhz666](https://github.com/langhz666)